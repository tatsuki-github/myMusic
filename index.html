<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>旋律づくり</title>

    <script>
          document.write(
            '<link rel="stylesheet" href="css/style.css?' + new Date().getTime() + '">'
          );
    </script>
    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/abcjs-basic.js"></script>
    <script src="js/abcjs_midi_5.12.0-min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/abcjs-audio.css">
    <link
          rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"
        />
</head>

<body onload="load()">
<div class="rhythm_img">
  <div class="div">
    <img src="img/tan.jpg" alt="" id="tan">
  </div>

  <div>
    <img src="img/tata.jpg" alt="" id="tata">
  </div>
    
  <div>
    <img src="img/un.jpg" alt="" id="un">
  </div>

  <div>
    <img src="img/tau.jpg" alt="" id="tau">
  </div>

  <div>
    <img src="img/uta.jpg" alt="" id="uta">
  </div>

  <div>
    <img src="img/takka.png" alt="" id="takka">
  </div>

  <div>
    <img src="img/ta__n.jpg" alt="" id="ta__n">
  </div>

  <div>
    <img src="img/ta_nta.jpg" alt="" id="ta_nta">
  </div>
    
  <div>
    <img src="img/tata_n.jpg" alt="" id="tata_n">
  </div>
</div>


<div class="tempo_and_piano">
  <select name="tempo_category" id="tempo_category">
    <option value="tempo_60">&#9833; = 60</option>
    <option value="tempo_80">&#9833; = 80</option>
    <option value="tempo_100" selected>&#9833; = 100</option>
    <option value="tempo_120">&#9833; = 120</option>
    <option value="tempo_140">&#9833; = 140</option>
    <option value="tempo_160">&#9833; = 160</option>
  </select>
  <div class="buttons">
    <select name="play_mode" id="play_mode">
      <option value="play">再生</option>
      <option value="only_code">コードのみ</option>
      <option value="only_melody">旋律のみ</option>
    </select>
    <div id="audio" style="width:320px;"></div>  
  </div>
</div>


<div id="first">
  <div id="paper"></div>
</div>

<div class="beat">
  <input id="eighthNote" type="radio" name="beat" value="eighthNote">8分音符
  <input id="quarterNote" type="radio" name="beat" value="quarterNote" checked>４部音符
  <input id="dottedQuarterNote" type="radio" name="beat" value="dottedQuarterNote">付点４部音符
  <input id="halfNote" type="radio" name="beat" value="halfNote">2分音符
  <button id="eighthRest">８分休符</button>
  <button id="quarterRest">4分休符</button>
  <button id="oneBack">1つ戻る</button>
</div>

<div class="piano">
  <div class="key white" id="do"><p>ド</p></div>
  <div class="black"></div>
  <div class="key white" id="re"><p>レ</p></div>
  <div class="black"></div>
  <div class="key white" id="mi"><p>ミ</p></div>
  <div class="key white" id="fa"><p>ファ</p></div>
  <div class="black"></div>
  <div class="key white" id="so"><p>ソ</p></div>
  <div class="black"></div>
  <div class="key white" id="ra"><p>ラ</p></div>
  <div class="black"></div>
  <div class="key white" id="shi"><p>シ</p></div>
  <div class="key white" id="do_high"><p>ド↑</p></div>
  <div class="black"></div>
  <div class="key white" id="re_high"><p>レ↑</p></div>
  <div class="black"></div>
  <div class="key white" id="mi_high"><p>ミ↑</p></div>
</div>
<script>

//ロード
function load(){
  for(i = 0; i < 32; i++){
    notes[i] = " ";
  }
  ABCJS.renderAbc("paper","M:4/4\nL:1/8\nK:C\n " + `"C"` + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6]+ notes[7] + "|" + `"F"` + `${notes[8]}` + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14]+ notes[15] + "|" + `"G"` + `${notes[16]}` + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22]+ notes[23] + "|" + `"C"` + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30]+ notes[31] + "|"  ,{responsive: "resize",paddingtop:"0",paddingbottom:"8"});
}

//リズム再生
document.getElementById("tan").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  synth.triggerAttackRelease("E4", "4n");
}, false);

document.getElementById("tata").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [{note: "E4", duration: "8n"},{note: "E4", duration: "8n"}];
  function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
  }
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);

document.getElementById("tau").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [{note: "E4", duration: "8n"},null];

function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
}
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);

document.getElementById("uta").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [null,{note: "E4", duration: "8n"}];

function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
}
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);

document.getElementById("takka").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [{note: "E4", duration: "6n"},[null,{note: "E4", duration: "16n"}]];

function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
}
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);

document.getElementById("ta__n").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  synth.triggerAttackRelease("E4", "2n");
}, false);

document.getElementById("ta_nta").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [[{note: "E4", duration: "3n"}],null,[null,{note: "E4", duration: "8n"}]];

function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
}
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);

document.getElementById("tata_n").addEventListener("click", function() {
  const synth = new Tone.Synth().toDestination();
  changeTempo();
  const melodyList = [[{note: "E4", duration: "8n"}],[{note: "E4", duration: "3n"}]];

function setPlay(time, note) {
  synth.triggerAttackRelease(note.note, note.duration, time);
}
  const melody = new Tone.Sequence(setPlay, melodyList).start();
  melody.loop = 0; 
  Tone.Transport.start();
}, false);



//全体で使う変数や設定など
    const tempo_category = document.getElementById("tempo_category");
    const play_mode = document.getElementById("play_mode");
    play_mode.onchange = displayNote;
    const notes = new Array(32); 

//テンポ切り替え
tempo_category.onchange = changeTempo;
function changeTempo(){
  switch (tempo_category.value){
  case "tempo_60":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:60,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:60,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:60,chordsOff:true});
          break;
      default: 
    }    
      break;
  case "tempo_80":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:80,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:80,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:80,chordsOff:true});
          break;
      default: 
    }    
      break;
  case "tempo_100":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:100,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:100,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:100,chordsOff:true});
          break;
      default: 
    }  
      break;
  case "tempo_120":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:120,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:120,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:120,chordsOff:true});
          break;
      default: 
    }    
      break;    
  case "tempo_140":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:140,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:140,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:140,chordsOff:true});
          break;
      default: 
    }    
      break;    
  case "tempo_160":
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:160,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:160,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:160,chordsOff:true});
          break;
      default: 
    }       
      break;      
  default: 
    switch (play_mode.value){
      case "play":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|" +
        "\nV:2\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" ,{qpm:100,chordsOff:true});
          break;  
      case "only_code":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\nV:1\n" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|" + `"F"[F4A4c4f4]"F"[F4A4c4f4]` + "|" + `"G"[G4B4D4d4]"G"[G4B4D4d4]` +  "|" + `"C"[C4E4G4c4]"C"[C4E4G4c4]` + "|",{qpm:100,chordsOff:true});
          break;
      case "only_melody":
        ABCJS.renderMidi( "audio","M:4/4\nL:1/8\nK:C\n" + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6] + notes[7] + "|" + `${notes[8]}`  + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14] + notes[15] + "|" + `${notes[16]}`  + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22] + notes[23] + "|" + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30] + notes[31] + "|",{qpm:100,chordsOff:true});
          break;
      default: 
    }    
  }  
}

//楽譜表示
function displayNote(){
  changeTempo();
  ABCJS.renderAbc("paper","M:4/4\nL:1/8\nK:C\n " + `"C"` + `${notes[0]}` + notes[1] + notes[2] + notes[3] + notes[4] + notes[5] + notes[6]+ notes[7] + "|" + `"F"` + `${notes[8]}` + notes[9] + notes[10] + notes[11] + notes[12] + notes[13] + notes[14]+ notes[15] + "|" + `"G"` + `${notes[16]}` + notes[17] + notes[18] + notes[19] + notes[20] + notes[21] + notes[22]+ notes[23] + "|" + `"C"` + `${notes[24]}` + notes[25] + notes[26] + notes[27] + notes[28] + notes[29] + notes[30]+ notes[31] + "|"  ,{responsive: "resize",paddingtop:"0",paddingbottom:"8"});

}  

//楽譜表示切り替え
//ド→C レ→D ミ→E ファ→F ソ→G ラ→A シ→B ド→c レ→d ミ→e


//音源
function playSingleNote(note,beat) {
  const synth = new Tone.Synth().toDestination();
  synth.triggerAttackRelease(note, beat);
}

let eighthNote = document.getElementById("eighthNote");
let quarterNote = document.getElementById("quarterNote");
let dottedQuarterNote = document.getElementById("dottedQuarterNote");
let halfNote = document.getElementById("halfNote");

let notesCount = 0;

const wrong = new Audio('audio/wrong.mp3');

function soundAndDisplayNote(sound,display) {
  if(eighthNote.checked){
      if(notesCount >= 32){
        wrong.play();
      }
      else if(notesCount%2 == 0){
        playSingleNote(sound,"8n");
        notes[notesCount] = display;
      }
      else{
        playSingleNote(sound,"8n");
        notes[notesCount] = display + " ";
      }
      notesCount++;
    }
    else if(quarterNote.checked){
      if(notesCount == 7 || notesCount == 15 || notesCount == 23 || notesCount == 31 || notesCount >= 32){
        wrong.play();
      }
      else{
        playSingleNote(sound,"4n");
        notes[notesCount] = display + "2";
        notesCount+=2;
      }
    }
    else if(dottedQuarterNote.checked){
      if(notesCount == 6 || notesCount == 7 || notesCount == 14 || notesCount == 15 || notesCount == 22 || notesCount == 23 || notesCount == 30 || notesCount == 31 || notesCount >= 32){
        wrong.play();
      }
      else{
        playSingleNote(sound,"3n");
        notes[notesCount] = display + "3";
        notesCount+=3;
      }
    }
    else if(halfNote.checked){
      if(notesCount == 5 || notesCount == 6 || notesCount == 7 || notesCount == 13 || notesCount == 14 || notesCount == 15 || notesCount == 21 || notesCount == 22 || notesCount == 23 || notesCount == 29 || notesCount == 30 || notesCount == 31 || notesCount >= 32){
        wrong.play();
      }
      else{
        playSingleNote(sound,"2n");
        notes[notesCount] = display + "4";
        notesCount+=4;
      }
    }
}

document.getElementById("eighthRest").addEventListener("click", function() {
  if(notesCount >= 32){
        wrong.play();
      }
  else if(notes[notesCount - 1] == " z"){
    notes[notesCount - 1] = "z2";
    notesCount++;
    displayNote();
  }
  else{
    notes[notesCount] = " z";
    notesCount++;
    displayNote();
  }
}, false);

document.getElementById("quarterRest").addEventListener("click", function() {
  if(notesCount == 7 || notesCount == 15 || notesCount == 23 || notesCount == 31 || notesCount >= 32){
        wrong.play();
      }
      else{
        notes[notesCount] = "z2";
        notesCount+=2;
        displayNote();
      }
}, false);

document.getElementById("oneBack").addEventListener("click", function() {
  if(notesCount == 0){
    wrong.play();
  }
  else if(notes[notesCount-1] == "C" || notes[notesCount-1] == "D" || notes[notesCount-1] == "E" || notes[notesCount-1] == "F" || notes[notesCount-1] == "G" || notes[notesCount-1] == "A" || notes[notesCount-1] == "B" || notes[notesCount-1] == "c" || notes[notesCount-1] == "d" || notes[notesCount-1] == "e" || notes[notesCount-1] == "C " || notes[notesCount-1] == "D " || notes[notesCount-1] == "E " || notes[notesCount-1] == "F " || notes[notesCount-1] == "G " || notes[notesCount-1] == "A " || notes[notesCount-1] == "B " || notes[notesCount-1] == "c " || notes[notesCount-1] == "d " || notes[notesCount-1] == "e "){
    notes[notesCount-1] = "";
    notesCount--;
    displayNote();
  }
  else if(notes[notesCount-2] == "C2" || notes[notesCount-2] == "D2" || notes[notesCount-2] == "E2" || notes[notesCount-2] == "F2" || notes[notesCount-2] == "G2" || notes[notesCount-2] == "A2" || notes[notesCount-2] == "B2" || notes[notesCount-2] == "c2" || notes[notesCount-2] == "d2" || notes[notesCount-2] == "e2" ){
    notes[notesCount-2] = "";
    notesCount-=2;
    displayNote();
  }
  else if(notes[notesCount-3] == "C3" || notes[notesCount-3] == "D3" || notes[notesCount-3] == "E3" || notes[notesCount-3] == "F3" || notes[notesCount-3] == "G3" || notes[notesCount-3] == "A3" || notes[notesCount-3] == "B3" || notes[notesCount-3] == "c3" || notes[notesCount-3] == "d3" || notes[notesCount-3] == "e3" ){
    notes[notesCount-3] = "";
    notesCount-=3;
    displayNote();
  }
  else if(notes[notesCount-4] == "C4" || notes[notesCount-4] == "D4" || notes[notesCount-4] == "E4" || notes[notesCount-4] == "F4" || notes[notesCount-4] == "G4" || notes[notesCount-4] == "A4" || notes[notesCount-4] == "B4" || notes[notesCount-4] == "c4" || notes[notesCount-4] == "d4" || notes[notesCount-4] == "e4" ){
    notes[notesCount-4] = "";
    notesCount-=4;
    displayNote();
  }
  else if(notes[notesCount-1] == " z"){
    notes[notesCount-1] = "";
    notesCount--;
    displayNote();
  }
  else if(notes[notesCount-2] == "z2"){
    notes[notesCount-2] = "";
    notesCount-=2;
    displayNote();
  }
}, false);

//鍵盤音階再生
document.getElementById("do").addEventListener("click", function() {
    soundAndDisplayNote("C4","C");
    displayNote();
}, false);

  document.getElementById("re").addEventListener("click", function() {
    soundAndDisplayNote("D4","D");
    displayNote();
}, false);

  document.getElementById("mi").addEventListener("click", function() {
    soundAndDisplayNote("E4","E");
    displayNote();
}, false);

  document.getElementById("fa").addEventListener("click", function() {
    soundAndDisplayNote("F4","F");
    displayNote();
}, false);

  document.getElementById("so").addEventListener("click", function() {
    soundAndDisplayNote("G4","G");
    displayNote();
}, false);

  document.getElementById("ra").addEventListener("click", function() {
    soundAndDisplayNote("A4","A");
    displayNote();
}, false);

  document.getElementById("shi").addEventListener("click", function() {
    soundAndDisplayNote("B4","B");
    displayNote();
}, false);

  document.getElementById("do_high").addEventListener("click", function() {
    soundAndDisplayNote("C5","c");
    displayNote();
}, false);

  document.getElementById("re_high").addEventListener("click", function() {
    soundAndDisplayNote("D5","d");
    displayNote();
}, false);

  document.getElementById("mi_high").addEventListener("click", function() {
    soundAndDisplayNote("E5","e");
    displayNote();
}, false);


</script>
</body>
</html>
